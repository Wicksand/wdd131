//recipies ----------------------------

const recipe = [
  { 
    "tags": ["Cookies", "Chocolate", "Dessert"],
    "image": "dessert.png",
    "imgName": "cookies",
    "ingredient": [
      "2/3 cup shortening",
      "2/3 cup butter",
      "2 eggs",
      "1 cup brown sugar",
      "1 cup white sugar",
      "2 tsp vanilla extract",
      "1 tsp salt",
      "1 tsp baking soda",
      "3 cups flour",
      "1 bag of chocolate chips"
    ],
    "ingredientHalf": [
      "1/3 cup shortening",
      "1/3 cup butter",
      "1 egg",
      "1/2 cup brown sugar",
      "1/2 cup white sugar",
      "1 tsp vanilla extract",
      "1/2 tsp salt",
      "1/2 tsp baking soda",
      "1.5 cups flour",
      "1/2 bag of chocolate chips"
    ],
    "ingredientDouble": [
      "1 1/3 cups shortening",
      "1 1/3 cups butter",
      "4 eggs",
      "2 cups brown sugar",
      "2 cups white sugar",
      "4 tsp vanilla extract",
      "2 tsp salt",
      "2 tsp baking soda",
      "6 cups flour",
      "2 bags of chocolate chips"
    ],
    "name": "Foolproof Chocolate Chip Cookies",
    "prepTime": "30 Min",
    "instructions": [
      "Cream together shortening, butter, eggs, brown sugar, white sugar, and vanilla extract until fully combined.",
      "In a separate bowl, combine baking soda, salt, and flour.",
      "Gradually add the dry mixture to the wet mixture, mixing as you go.",
      "Add the chocolate chips and mix until evenly distributed.",
      "Roll or scoop cookie dough into balls and place on a baking sheet.",
      "Bake in a preheated oven at 375°F for 8–10 minutes or until golden around the edges."
    ]
  },
{
  "tags": ["Cookies", "Lemon", "Dessert"],
  "image": "dessert.png",
  "imgName": "cookies",
  "ingredient": [
    "2 1/4 cups flour",
    "1/2 tsp baking powder",
    "1/2 tsp salt",
    "1 cup butter (softened)",
    "3/4 cup sugar",
    "1 egg",
    "2 Tbsp lemon peel (divided)",
    "1 tsp vanilla",
    "1 cup powdered sugar (for glaze)",
    "4–5 tsp lemon juice (for glaze)",
    "Remaining lemon peel (for glaze)"
  ],
  "ingredientHalf": [
    "1 1/8 cups flour",
    "1/4 tsp baking powder",
    "1/4 tsp salt",
    "1/2 cup butter (softened)",
    "3/8 cup sugar",
    "1/2 egg",
    "1 Tbsp lemon peel (divided)",
    "1/2 tsp vanilla",
    "1/2 cup powdered sugar (for glaze)",
    "2–2.5 tsp lemon juice (for glaze)",
    "Remaining lemon peel (for glaze)"
  ],
  "ingredientDouble": [
    "4 1/2 cups flour",
    "1 tsp baking powder",
    "1 tsp salt",
    "2 cups butter (softened)",
    "1 1/2 cups sugar",
    "2 eggs",
    "4 Tbsp zest (divided)",
    "2 tsp vanilla",
    "2 cups powdered sugar (for glaze)",
    "8–10 tsp lemon juice (for glaze)",
    "Remaining lemon zest (for glaze)"
  ],
  "name": "Jessica’s Lemon Shortbread Cookies",
  "prepTime": "30 Min",
  "instructions": [
    "Preheat oven to 375°F.",
    "In a bowl, combine flour, baking powder, and salt. Set aside.",
    "In a large bowl, beat softened butter and sugar until light and fluffy.",
    "Beat in the egg, half of the lemon zest, and vanilla until well blended.",
    "Gradually beat in the flour mixture on low speed until fully incorporated.",
    "Scoop dough and form into cookies; place on a baking sheet.",
    "Bake for 12–14 minutes, or until edges are lightly golden.",
    "To make the glaze, mix powdered sugar with 4–5 tsp lemon juice and the remaining lemon peel.",
    "Drizzle glaze over cooled cookies before serving."
  ]
},
{
  "tags": ["Bread", "Dessert", "Chocolate"],
  "image": "bread.png",
  "imgName": "bread",
  "ingredient": [
    "1 cup white sugar",
    "½ cup butter, melted",
    "2 eggs",
    "1 teaspoon vanilla extract",
    "1 ½ cups all-purpose flour",
    "1 teaspoon baking soda",
    "½ teaspoon salt",
    "½ cup Vanilla Greek Yogurt",
    "½ cup chocolate chips",
    "2 medium bananas, mashed"
  ],
  "ingredientHalf": [
    "½ cup white sugar",
    "¼ cup butter, melted",
    "1 egg",
    "½ teaspoon vanilla extract",
    "¾ cup all-purpose flour",
    "½ teaspoon baking soda",
    "¼ teaspoon salt",
    "¼ cup Vanilla Greek Yogurt",
    "¼ cup chocolate chips",
    "1 medium banana, mashed"
  ],
  "ingredientDouble": [
    "2 cups white sugar",
    "1 cup butter, melted",
    "4 eggs",
    "2 teaspoons vanilla extract",
    "3 cups all-purpose flour",
    "2 teaspoons baking soda",
    "1 teaspoon salt",
    "1 cup Vanilla Greek Yogurt",
    "1 cup chocolate chips",
    "4 medium bananas, mashed"
  ],
  "name": "Mission Banana Bread",
  "prepTime": "1 hour 15 Min",
  "instructions": [
  "Preheat your oven to 350°F (175°C). Grease a loaf pan or line it with parchment paper. Alternatively, prepare muffin tins with paper liners or grease them.",
  "In a large mixing bowl, beat the eggs, white sugar, and vanilla extract until smooth using a hand mixer or whisk.",
  "Slowly pour in the melted butter while mixing until well combined.",
  "In a separate bowl, whisk together the flour, baking soda, and salt to distribute evenly.",
  "Gradually add the dry ingredients to the wet mixture, stirring gently until no dry flour remains. Avoid overmixing.",
  "Fold in the Vanilla Greek Yogurt and mashed bananas gently until just combined.",
  "Fold in the chocolate chips evenly, taking care not to overmix.",
  "For a loaf: Pour batter into the prepared pan and bake for about 1 hour. Check at 55 minutes by inserting a toothpick—it should come out clean or with a few moist crumbs.(20min for muffins/ 12-15 for mini muffins)",
  "Allow the baked bread or muffins to cool in the pan for 10-15 minutes, then transfer to a wire rack to cool completely before serving."
  ]
},
{
  "tags": ["Breakfast", "Baked", "Pancakes"],
  "image": "breakfast.png",
  "imgName": "breakfast",
  "ingredient": [
    "1 cup flour",
    "1 cup milk",
    "6 eggs",
    "¼ cup salted butter"
  ],
  "ingredientHalf": [
    "½ cup flour",
    "½ cup milk",
    "3 eggs",
    "2 Tbsp salted butter"
  ],
  "ingredientDouble": [
    "2 cups flour",
    "2 cups milk",
    "12 eggs",
    "½ cup salted butter"
  ],
  "name": "German Pancakes (Dutch Babies)",
  "prepTime": "30 Min",
  "instructions": [
    "Prepare your toppings ahead of time so they can be added immediately when pancakes are done.",
    "Place the butter in a flat-bottomed casserole pan with at least 2-inch tall sides. Two 8x12x2 inch pans work well.",
    "Place the pan in the oven and preheat to 425°F (220°C), allowing the butter to melt in the process.",
    "While the oven preheats, whisk together the milk, flour, and eggs until smooth.",
    "Once the butter is fully melted and the oven is hot, carefully remove the pan and pour the batter into the melted butter.",
    "Return the pan to the oven and bake for about 20 minutes or until the peaks are puffed and golden brown.",
    "Remove from the oven, slice into large squares, and serve immediately while hot."
  ]
},
{
  "tags": ["Bread", "Side Dish", "Cheesy"],
  "image": "bread.png",
  "imgName": "bread",
  "ingredient": [
    "1 Tbsp yeast",
    "2 Tbsp sugar",
    "1 tsp salt",
    "1 ½ cup warm water",
    "3 cups flour",
    "½ cup butter",
    "Parmesan cheese (for topping)"
  ],
  "ingredientHalf": [
    "½ Tbsp yeast",
    "1 Tbsp sugar",
    "½ tsp salt",
    "¾ cup warm water",
    "1½ cups flour",
    "¼ cup butter",
    "Parmesan cheese (for topping)"
  ],
  "ingredientDouble": [
    "2 Tbsp yeast",
    "4 Tbsp sugar",
    "2 tsp salt",
    "3 cup warm water",
    "6 cups flour",
    "1 cup butter",
    "Parmesan cheese (for topping)"
  ],
  "name": "Mom’s Breadsticks",
  "instructions": [
    "Preheat your oven to 350°F (175°C).",
    "Dissolve yeast, sugar, and salt in the warm water in a large mixing bowl.",
    "Add the flour to form a dough, then let it rest for 10 minutes.",
    "While waiting, place the butter on a baking sheet and melt it in the oven as it preheats.",
    "Roll out the dough and cut it into breadstick shapes.",
    "Place the breadsticks into the melted butter on the pan with the sides touching.",
    "Let the dough sit for another 15 minutes to rise slightly.",
    "Sprinkle the tops with Parmesan cheese.",
    "Bake for 20 minutes or until golden brown.",
    "Serve warm and enjoy!"
  ]
}
]

//recipe templates --------------------

function recipeTemplate(recipe, index){
  let html = `<section class= recipe>
                <img src = "${recipe.image}" alt = "${recipe.imgName}" class = "Foodimg">
                <div class="info">
                  <h2 class = "name"> ${recipe.name}</h2>
                  <div class = "tags">${tagsTemplate(recipe.tags)}</div>

                <div class="accordion">
                    <button class="accordion-header">Recipe</button>
                    <div class="accordion-content">
                    <button class="half-btn" data-index="${index}">½</button>
                    <button class="full-btn" data-index="${index}" >1</button>
                    <button class="double-btn" data-index="${index}">2</button>

                    <h3>Ingredients</h3>
                    <ul>
                        ${ingredientTemplate(recipe.ingredient)}
                    </ul>
<h3>
Instructions
</h3>
<ol>
${instructionsTemplate(recipe.instructions)}
</ol>
                </div>
            </div>

        </section>`
	return html;
}

function tagsTemplate(tags){
	let html1 = ``;
	for(let tag of tags){
		html1 += `<p class="tag">${tag}</p>`;
	}
	return html1;
}
function ingredientTemplate(ingredients) {
  let html = ``;
  for (let item of ingredients) {
    html += `<li>${item}</li>`;
  }
  return html;
}

function instructionsTemplate(instructions) {
  let html = ``;
  for (let step of instructions) {
    html += `<li>${step}</li>`;
  }
  return html;
}

//render -----------------------------
const main = document.querySelector('#recipe-book');

recipe.forEach((r, i) => {
  main.innerHTML += recipeTemplate(r,i);
});

attachButtons();
attachAccordion();

// accordion -------------------------
function attachAccordion(){
  const accordions = document.querySelectorAll('.accordion-header');

  accordions.forEach(accordion => {
    accordion.addEventListener('click', () => {
      accordion.classList.toggle('active');

      const content = accordion.nextElementSibling;
      if (content.style.maxHeight) {
        content.style.maxHeight = null; // collapse
      } else {
        content.style.maxHeight = content.scrollHeight + 'px'; // expand
      }
    });
  });
}


//conversion buttions ---------------


function updateIngredients(button, scale){
  const index = button.getAttribute('data-index');
  const ul = button.closest('.accordion-content').querySelector('ul');
  
  ul.innerHTML =  recipe[index][scale].map(item => `<li>${item}</li>`).join('');
}

function attachButtons(){

const halfButtons = main.querySelectorAll('.half-btn');
const fullButtons = main.querySelectorAll('.full-btn');
const doubleButtons = main.querySelectorAll('.double-btn');

halfButtons.forEach(function(button) {
  button.addEventListener('click',function(event){
    updateIngredients(event.target, 'ingredientHalf');
  });
});
fullButtons.forEach(function(button) {
  button.addEventListener('click',function(event){
    updateIngredients(event.target, 'ingredient');
  });
});
doubleButtons.forEach(function(button){
  button.addEventListener('click',function(event){
    updateIngredients(event.target, 'ingredientDouble');
  });
});
}

// Filtering -------------------------------------
const searchBtn = document.querySelector('#searchBtn');
searchBtn.addEventListener('click', search);

function filterRecipes(query) {
  const lowerQuery = query.toLowerCase();
  return recipe.filter(function(r) {
    return (
      r.name.toLowerCase().includes(lowerQuery) ||

      r.instructions.some(function(step) {
        return step.toLowerCase().includes(lowerQuery);
      }) ||

      r.tags.some(function(tag) {
        return tag.toLowerCase().includes(lowerQuery);
      }) ||

      r.ingredient.some(function(ing) {
        return ing.toLowerCase().includes(lowerQuery);
      })
    );
  });
}

function search(){
  const input = document.querySelector('#searchInput');
  const query = input.value.trim();

  const results = filterRecipes(query);
  main.innerHTML = '';
  results.forEach((r,i) => {
    const ogindex = recipe.indexOf(r);
    main.innerHTML += recipeTemplate(r,ogindex);
    
  });

  attachAccordion();
  attachButtons();
  input.value = ''; // optional reset
}

const input = document.querySelector('#searchInput');
input.addEventListener('keydown',function(event){
  if(event.key === 'Enter'){search();}
})